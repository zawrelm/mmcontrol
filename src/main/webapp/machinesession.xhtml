<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:icecore="http://www.icefaces.org/icefaces/core"
      xmlns:ace="http://www.icefaces.org/icefaces/components"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:head></h:head>
    <h:body>
        <ui:composition template="./WEB-INF/includes/template.xhtml">

            <ui:define name="content">
                <div id="main">
                    <h:form id="session">
                        <h:commandButton id="buttonRefresh" value="#{msg.refresh}">
                            <f:ajax execute="@this" render="@all"/>
                        </h:commandButton>
                        <h2>#{msg.session}</h2>
                        <span>#{msg.user}: #{loginCtrl.user.title}, #{loginCtrl.user.firstname} #{loginCtrl.user.lastname}" 
                            (#{msg.since} #{loginCtrl.user.currentSession.beginTime})<br/>
                        </span>
                        <!--span>#{msg.observers} (#{msg.invite}): Dr. Jorge Bauer, Dr. Numan Durakbasa </span><br/-->
                        <!--span>
                            <h:outputLabel value="#{msg.whichprobinghead}" for="probinghead" />
                            <h:selectOneMenu id="probinghead" label="#{msg.whichprobinghead}" required="true"> <value="#{sessionCtrl.head}"> converter="ProbingHeadConverter">
                                <f:selectItems value="#{inventoryCtrl.heads}" />
                            </h:selectOneMenu><br />
                        </span-->
                        <span>
                            <h:outputLabel value="#{msg.machine}: " for="machineselection" />
                            <ace:simpleSelectOneMenu id="machineselection" label="#{msg.machine}" required="true" 
                                                value="#{loginCtrl.selectedMachine}" rendered="#{empty loginCtrl.selectedMachine}">
                                <ace:ajax />
                                <f:converter binding="#{machineConverter}"/>
                                <f:selectItem itemLabel="-Select-" itemValue="None" noSelectionOption="true" />
                                <c:forEach items="#{mainCtrl.machineMgmt.listOfConnectedMachines}" var="currentMachine">
                                    <f:selectItem itemValue="#{currentMachine}"/>
                                </c:forEach>
                            </ace:simpleSelectOneMenu>
                            <h:outputText value="#{loginCtrl.selectedMachine}" rendered="#{!empty loginCtrl.selectedMachine}" />
                            <br />
                        </span>
                        <span>#{msg.mountobject}<br/>
                        </span>
                        <ul id="sessionmanagement">
                            <li><h:commandButton id="startProbeNoRec" value="#{msg.probe_norecord}" 
                                                 actionListener="#{sessionCtrl.startProbeWithoutRecording()}" 
                                                 rendered="#{!empty loginCtrl.selectedMachine and empty sessionCtrl.activeSession}"
                                                 /></li>
                            <!--li>Not implemented: #{msg.probe_withrecord}</li>
                            <li>Not implemented: #{msg.probe_automatically}</li-->
                            <li><h:commandButton id="stopProbe" value="#{msg.probe_stop}" 
                                                 actionListener="#{sessionCtrl.stopProbe()}" 
                                                 rendered="#{!empty sessionCtrl.activeSession}" /></li>
                        </ul>
                    </h:form>
                    <div id="controlpanel">
                        <h:form id="fOperation" rendered="#{!empty sessionCtrl.activeSession}">
                            <hr/>
                            <h3>#{msg.probefunctions}</h3>
                            <h:outputText id="otCalibration" value="#{msg.calibrating}" rendered="#{loginCtrl.selectedMachine.operation == 'CALIBRATION'}" />

                            <h:panelGrid id="pgFunctions" columns="6" rendered="#{loginCtrl.selectedMachine.operation != 'CALIBRATION'}" >
                                <h:commandButton 
                                    id="cbPlane" 
                                    image="resources/img/button_plane.jpg"
                                    value="#{msg.plane_in3}"
                                    actionListener="#{operationCtrl.probePlane()}"
                                    disabled="#{loginCtrl.selectedMachine.operation != 'WAITING_ALREADY_CALIBRATED'}"
                                    styleClass="actionButton"/>
                                    
                                <h:commandButton 
                                    id="cbDiameter" 
                                    image="resources/img/button_diameter.jpg" 
                                    disabled="#{loginCtrl.selectedMachine.operation != 'WAITING_ALREADY_CALIBRATED'}"
                                    styleClass="actionButton"/>
                                    
                                <h:commandButton 
                                    id="cbDistance" 
                                    image="resources/img/button_distance.jpg" 
                                    disabled="#{loginCtrl.selectedMachine.operation != 'WAITING_ALREADY_CALIBRATED'}"
                                    styleClass="actionButton"/>
                                    
                                <h:commandButton 
                                    id="cbPoint" 
                                    image="resources/img/button_point.jpg" 
                                    disabled="#{loginCtrl.selectedMachine.operation != 'WAITING_ALREADY_CALIBRATED'}"
                                    styleClass="actionButton"/>
                                    
                                <ace:tooltip id="ttPlaneAction"
                                        for="cbPlane"
                                        showEffect="grow"
                                        hideEffect="grow"
                                        position="topLeft"
                                        targetPosition="bottomLeft"
                                        styleClass="actionTooltip">
                                    <h:panelGrid styleClass="tooltipBoxStyle"> 
                                        <h:outputText id="otttPlane" value="#{msg.ttPlaneAction}"/>
                                    </h:panelGrid>
                                </ace:tooltip>

                                <ace:tooltip id="ttDiameterAction"
                                        for="cbDiameter"
                                        showEffect="grow"
                                        hideEffect="grow"
                                        position="topLeft"
                                        targetPosition="bottomLeft"
                                        styleClass="actionTooltip">
                                    <h:panelGrid styleClass="tooltipBoxStyle"> 
                                        <h:outputText id="otttDiameter" value="#{msg.ttDiameterAction}"/>
                                    </h:panelGrid>
                                </ace:tooltip>

                                <ace:tooltip id="ttDistanceAction"
                                        for="cbDistance"
                                        showEffect="grow"
                                        hideEffect="grow"
                                        position="topLeft"
                                        targetPosition="bottomLeft"
                                        styleClass="actionTooltip">
                                    <h:panelGrid styleClass="tooltipBoxStyle"> 
                                        <h:outputText id="otttDistance" value="#{msg.ttDistanceAction}"/>
                                    </h:panelGrid>
                                </ace:tooltip>

                                <ace:tooltip id="ttPointAction"
                                        for="cbPoint"
                                        showEffect="grow"
                                        hideEffect="grow"
                                        position="topLeft"
                                        targetPosition="bottomLeft"
                                        styleClass="actionTooltip">
                                    <h:panelGrid styleClass="tooltipBoxStyle"> 
                                        <h:outputText id="otttPoint" value="#{msg.ttPointAction}"/>
                                    </h:panelGrid>
                                </ace:tooltip>
                                    
                            </h:panelGrid>

                            <h:panelGrid columns="2">
                                
                                <h:panelGroup id="pgOperationState">

                                    <h:panelGrid columns="2">
                                        <h:outputLabel id="olCurrentAction" value="#{msg.currentAction}: "/>
                                        <h:outputText id="otCurrentAction" value="#{loginCtrl.selectedMachine.operation} 
                                                      - #{loginCtrl.selectedMachine.operationState}" style="width: 50px"/>
                                    </h:panelGrid>

                                    <h:panelGrid columns="7">
                                        <h:outputLabel id="olXPoint1" value="#{msg.point} 1 - "/>
                                        <h:outputLabel id="olXPointX1" value="X:"/>
                                        <h:outputText id="otXPos1" value="-0.00333" styleClass="pointPosOutText"/>
                                        <h:outputLabel id="olXPointY1" value="Y:"/>
                                        <h:outputText id="otYPos1" value="-0.00333" styleClass="pointPosOutText" />
                                        <h:outputLabel id="olXPointZ1" value="Z:"/>
                                        <h:outputText id="otZPos1" value="-0.00333" styleClass="pointPosOutText"/>

                                        <h:outputLabel id="olXPoint2" value="#{msg.point} 2 - "/>
                                        <h:outputLabel id="olXPointX2" value="X:"/>
                                        <h:outputText id="otXPos2" value="-0.00333" styleClass="pointPosOutText"/>
                                        <h:outputLabel id="olXPointY2" value="Y:"/>
                                        <h:outputText id="otYPos2" value="-0.00333" styleClass="pointPosOutText" />
                                        <h:outputLabel id="olXPointZ2" value="Z:"/>
                                        <h:outputText id="otZPos2" value="-0.00333" styleClass="pointPosOutText"/>

                                        <h:outputLabel id="olXPoint3" value="#{msg.point} 3 - "/>
                                        <h:outputLabel id="olXPointX3" value="X:"/>
                                        <h:outputText id="otXPos3" value="-0.00333" styleClass="pointPosOutText"/>
                                        <h:outputLabel id="olXPointY3" value="Y:"/>
                                        <h:outputText id="otYPos3" value="-0.00333" styleClass="pointPosOutText" />
                                        <h:outputLabel id="olXPointZ3" value="Z:"/>
                                        <h:outputText id="otZPos3" value="-0.00333" styleClass="pointPosOutText"/>
                                    </h:panelGrid>

                                    <h:panelGrid columns="3">
                                        <!--<h:commandButton id="cbCancel" value="#{msg.cancel}"  type="button" disabled="#{operationCtrl.currentAction==null}" onclick="ice.ace.instance('#{cdCancel.clientId}').show();return false;"/>  -->
                                        <h:commandButton id="cbCancel" value="#{msg.cancel}" actionListener="#{operationCtrl.cancelOperation()}" 
                                                         type="button" onclick="ice.ace.instance('#{cdCancel.clientId}').show();return false;" disabled="#{loginCtrl.selectedMachine.operation == 'WAITING_ALREADY_CALIBRATED'}"/> 
                                        <ace:confirmationDialog id="cdCancel" binding="#{cbCancel}"
                                                                message="#{msg.cancelTextConfDialog}"
                                                                header="#{msg.cancelHeaderConfDialog}"
                                                                closable="true"
                                                                position="center"
                                                                width="250"
                                                                height="130"
                                        >
                                            <h:panelGrid columns="2" styleClass="centeredPanelGrid">
                                                <h:commandButton id="yes" value="Yes" onclick="ice.ace.instance('#{cdCancel.clientId}').hide();">
                                                    <f:ajax execute="@this" render="@all"/>
                                                </h:commandButton>
                                                <h:commandButton id="no" value="No" onclick="ice.ace.instance('#{cdCancel.clientId}').hide();">
                                                    <f:ajax execute="@this" render="@all"/>
                                                </h:commandButton>
                                            </h:panelGrid>
                                        </ace:confirmationDialog>                                        

                                        <h:commandButton id="cbMeasure" value="Medir" actionListener="#{operationCtrl.measurePosition()}" rendered="#{!operationCtrl.operationTerminable}" />

                                        <h:commandButton id="cbCalculate" value="Calcular" actionListener="#{operationCtrl.finishOperation()}" rendered="#{operationCtrl.operationTerminable}" />
                                    </h:panelGrid>

                                </h:panelGroup>
                                
                                <ace:graphicImage id="imgVideo" value="resources/img/video.png" styleClass="videoImage" />

                            </h:panelGrid>
                                
                            <h:panelGroup id="pgMoves"> 

                                <h:panelGrid id="pgAxisX" columns="9">
                                    <ace:graphicImage id="imgXAxis" value="resources/img/AxisX.png" styleClass="axisImage" />

                                    <h:commandButton 
                                        id="cbMinFastX" 
                                        image="resources/img/arrowFastMinX.png" 
                                        actionListener="#{operationCtrl.moveXFastBackwards(true)}" 
                                        styleClass="moveButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:commandButton 
                                        id="cbMinSlowX" 
                                        image="resources/img/arrowSlowMinX.png" 
                                        actionListener="#{operationCtrl.moveXSlowBackwards(true)}" 
                                        styleClass="moveButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:commandButton 
                                        id="cbMinStopX" 
                                        image="resources/img/stop.png" 
                                        actionListener="#{operationCtrl.stopX()}"
                                        styleClass="stopButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:commandButton 
                                        id="cbPosSlowX"
                                        image="resources/img/arrowSlowPosX.png" 
                                        actionListener="#{operationCtrl.moveXSlowForward(true)}"
                                        styleClass="moveButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:commandButton 
                                        id="cbPosFastX"
                                        image="resources/img/arrowFastPosX.png" 
                                        actionListener="#{operationCtrl.moveXFastForward(true)}" 
                                        styleClass="moveButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <ace:textEntry
                                        id="tePosX"
                                        binding="#{xGoPos}"
                                        converterMessage="#{msg.digitOnly}"
                                        converter="javax.faces.Double"
                                        styleClass="goPosInputtext"/>

                                    <h:commandButton 
                                        id="cbGoX" 
                                        value="#{msg.goPos}" 
                                        actionListener="#{operationCtrl.moveXToPosition(xGoPos.value)}"
                                        styleClass="goButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:outputText id="otXPos" value="X: #{operationCtrl.posX}" styleClass="outPosOutText" />
                                </h:panelGrid>

                                
                                <h:panelGrid id="pgAxisY" columns="9">
                                    <ace:graphicImage id="imgYAxis" value="resources/img/AxisY.png" styleClass="axisImage" />

                                    <h:commandButton 
                                        id="cbMinFastY"
                                        image="resources/img/arrowFastMinY.png" 
                                        actionListener="#{operationCtrl.moveYFastBackwards(true)}"
                                        styleClass="moveButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:commandButton 
                                        id="cbMinSlowY"
                                        image="resources/img/arrowSlowMinY.png" 
                                        actionListener="#{operationCtrl.moveYSlowBackwards(true)}"
                                        styleClass="moveButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>
                                            
                                    <h:commandButton 
                                        id="cbMinStopY" 
                                        image="resources/img/stop.png" 
                                        actionListener="#{operationCtrl.stopY()}"
                                        styleClass="stopButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:commandButton 
                                        id="cbPosSlowY"
                                        image="resources/img/arrowSlowPosY.png" 
                                        actionListener="#{operationCtrl.moveYSlowForward(true)}"
                                        styleClass="moveButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:commandButton 
                                        id="cbPosFastY"
                                        image="resources/img/arrowFastPosY.png" 
                                        actionListener="#{operationCtrl.moveYFastForward(true)}"
                                        styleClass="moveButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>
                                            
                                    <ace:textEntry
                                        id="tePosY"
                                        binding="#{yGoPos}"
                                        converterMessage="#{msg.digitOnly}"
                                        converter="javax.faces.Double"
                                        styleClass="goPosInputtext"/>

                                    <h:commandButton 
                                        id="cbGoY"
                                        value="#{msg.goPos}"
                                        actionListener="#{operationCtrl.moveYToPosition(yGoPos.value)}"
                                        styleClass="goButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:outputText id="otYPos" value="Y: #{operationCtrl.posY}" styleClass="outPosOutText"/>
                                </h:panelGrid>


                                <h:panelGrid id="pgAxisZ" columns="9">
                                    <ace:graphicImage id="imgZAxis" value="resources/img/AxisZ.png" styleClass="axisImage" />

                                    <h:commandButton 
                                        id="cbMinFastZ"
                                        image="resources/img/arrowFastMinZ.png" 
                                        actionListener="#{operationCtrl.moveZFastBackwards(true)}"
                                        styleClass="moveButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:commandButton 
                                        id="cbMinSlowZ"
                                        image="resources/img/arrowSlowMinZ.png" 
                                        actionListener="#{operationCtrl.moveZSlowBackwards(true)}"
                                        styleClass="moveButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>
                                            
                                    <h:commandButton 
                                        id="cbMinStopZ" 
                                        image="resources/img/stop.png" 
                                        actionListener="#{operationCtrl.stopZ()}"
                                        styleClass="stopButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:commandButton 
                                        id="cbPosSlowZ"
                                        image="resources/img/arrowSlowPosZ.png" 
                                        actionListener="#{operationCtrl.moveZSlowForward(true)}"
                                        styleClass="moveButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:commandButton 
                                        id="cbPosFastZ"
                                        image="resources/img/arrowFastPosZ.png" 
                                        actionListener="#{operationCtrl.moveZFastForward(true)}"
                                        styleClass="moveButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <ace:textEntry 
                                        id="tePosZ" 
                                        binding="#{zGoPos}" 
                                        converterMessage="#{msg.digitOnly}"
                                        converter="javax.faces.Double"
                                        styleClass="goPosInputtext"/>

                                    <h:commandButton 
                                        id="cbGoZ" 
                                        value="#{msg.goPos}" 
                                        actionListener="#{operationCtrl.moveZToPosition(zGoPos.value)}"
                                        styleClass="goButton">
                                        <f:ajax execute="@form" render="@none" />
                                    </h:commandButton>

                                    <h:outputText id="otZPos" value="Z: #{operationCtrl.posZ}" styleClass="outPosOutText"/>
                                </h:panelGrid>
                                    
                            </h:panelGroup>

                            <ace:growlMessages  id="allMsgsGrowl" autoHide="false" for="@all" position="top-right"/>
                                            
                            <!--hr/><br/><br/>Aca va el video de lo que se va filmando???<br/><br/-->

                         </h:form>
                                
<!--
    <ace:panel> 
     <h:form id="selectForm">
              <h:outputLabel for="selectPane"  value="Select a pane to open: "/>
         <h:selectOneMenu id="selectPane"  value="#{panelStackBean.currentId}">
             <f:selectItem itemValue="stackPane1" itemLabel="stackPane 1"/>
             <f:selectItem itemValue="stackPane2" itemLabel="stackPane 2" />
             <f:selectItem itemValue="stackPane3" itemLabel="stackPane 3" />
             <f:ajax execute="@this" render="@all"/>
         </h:selectOneMenu>          
        </h:form>
     </ace:panel>

    <ace:panel>
     <h:form id="stackPanelForm">
        <ace:panelStack id="stack1" selectedId="#{panelStackBean.currentId}">
            <ace:stackPane id="stackPane1" >
                <ace:panel id="panel1" header="stackPane1">
                    <h:outputText id="out1" value="This is stackPane #1." />
                </ace:panel>
            </ace:stackPane>
            <ace:stackPane id="stackPane2" >
                <ace:panel id="panel2" header="stackPane2">
                    <h:outputText id="out2" value="This is stackPane #2." />
                </ace:panel>
            </ace:stackPane>
            <ace:stackPane id="stackPane3" >
                <ace:panel id="panel3"  header="stackPane3">
                    <h:outputText id="out3" value="This is stackPane #3." />
                </ace:panel>
            </ace:stackPane>
        </ace:panelStack>
     </h:form>
    </ace:panel>  -->
                    <h:form id="fTrace">
                        
                        
<!--                        <ace:dataTable 
                            id="tTrace"
                            value="#{operationCtrl.traces}"
                            var="trace"
                            paginator="true"
                            rows="15">

                             <ace:column headerText="ID">
                                  <h:outputText value="#{trace.id}" />
                              </ace:column>

                              <ace:column headerText="#{msg.colOeration}">
                                  <h:outputText value="#{trace.operation}" />
                              </ace:column>

                              <ace:column headerText="#{msg.colDesc}">
                                  <h:outputText value="#{trace.desc}"/>
                              </ace:column>

                          </ace:dataTable>                        
    -->                    <div class="protocol">
                            <h2>#{msg.protocol}</h2>
                            <h:outputText id="otProtocol" value="0: ....1:...." />
                        </div>

                        <!-- TODO - Ver formato de datos de tabla de traceo -->
                        <!-- <h:commandButton id="cbDownload" value="#{msg.download}" action="#{operationCtrl.downloadFile}operationCtrl." /> -->
                        <!--<ace:dataExporter id="dataExporter" label="#{msg.download}" type="xls" target="tTrace" fileName="#{operationCtrl.fileName}"/> -->
                        <hr/>
                    </h:form>

                    </div>
                </div>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
